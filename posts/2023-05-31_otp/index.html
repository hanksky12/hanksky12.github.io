<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Sky Blog | MFA與OTP</title>
    <meta name="description" content="源起 最近自己在很多地方的登入都需要2FA驗證，先用手機裝驗證軟體掃ＱRCode，之後的每次登入都要輸 ">
    <link rel="canonical" href="https://hanksky12.github.io/posts/2023-05-31_otp/" />
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <meta property="og:title" content="MFA與OTP" />
<meta property="og:description" content="源起 最近自己在很多地方的登入都需要2FA驗證，先用手機裝驗證軟體掃ＱRCode，之後的每次登入都要輸" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hanksky12.github.io/posts/2023-05-31_otp/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-31T08:17:32+08:00" />
<meta property="article:modified_time" content="2023-05-31T08:17:32+08:00" />

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MFA與OTP"/>
<meta name="twitter:description" content="源起 最近自己在很多地方的登入都需要2FA驗證，先用手機裝驗證軟體掃ＱRCode，之後的每次登入都要輸"/>

    
        
    

    <link rel="stylesheet" href='/css/style.css' />
    <link rel="stylesheet" href='/css/search.css' />
    <link rel="stylesheet" href='/css/md_nb.css' />
    <link rel="stylesheet" href='/css/list.css' />
    <link rel="stylesheet" href='/css/terms.css' />
    <link rel="stylesheet" href='/css/taxonomy.css' />
    <link rel="stylesheet" href='/css/font-awesome-4.7.0/css/font-awesome.min.css' />
    <link rel="stylesheet" href='/css/home.css' />
    <link rel="stylesheet" href='/css/syntax.css' />
    
    <link rel="stylesheet" href='/css/shortcode.css' />
    
    
    <link rel="stylesheet" href='/css/_custom.css' />
    <style>
         
    </style>
    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
        <script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
    
    
    
    
    <script src="/js/lazysizes.min.js" async=""></script>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/search.js"></script>
    <script src="/js/md_nb.js"></script>
    <script src="/js/yes.js"></script>
    
</head><body style="font-family: ,'Helvetica Neue', Helvetica, Arial, 'PingFang SC', 'Hiragino Sans GB', 'Heiti SC', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;">
        <div class="loading">
            <div class="loading-bg"></div>
            <div class="loading-long">
                <div class="loading-short"></div>
            </div>
        </div>

        <header>
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="/">
                <span class="logo">Sky Blog</span>
            </a>
        </div>
        <div class="navbar-menu">
            
                <a href="/">
                    <div class="menu-item">
                        <div class="hengtiao-root">
                            <div class="hengtiao"></div>
                            <div class="name text-wbd-reverse"><i class='fa fa-home'></i> Home</div>
                        </div>
                    </div>
                </a>
            
                <a href="/posts">
                    <div class="menu-item">
                        <div class="hengtiao-root">
                            <div class="hengtiao"></div>
                            <div class="name text-wbd-reverse"><i class='fa fa-book'></i> Posts</div>
                        </div>
                    </div>
                </a>
            
                <a href="/categories">
                    <div class="menu-item">
                        <div class="hengtiao-root">
                            <div class="hengtiao"></div>
                            <div class="name text-wbd-reverse"><i class='fa fa-folder-open'></i> Categories</div>
                        </div>
                    </div>
                </a>
            
                <a href="/series">
                    <div class="menu-item">
                        <div class="hengtiao-root">
                            <div class="hengtiao"></div>
                            <div class="name text-wbd-reverse"><i class='fa fa-gears'></i> Series</div>
                        </div>
                    </div>
                </a>
            
                <a href="/tags">
                    <div class="menu-item">
                        <div class="hengtiao-root">
                            <div class="hengtiao"></div>
                            <div class="name text-wbd-reverse"><i class='fa fa-tags'></i> Tags</div>
                        </div>
                    </div>
                </a>
            
                <a href="/about">
                    <div class="menu-item">
                        <div class="hengtiao-root">
                            <div class="hengtiao"></div>
                            <div class="name text-wbd-reverse"><i class='fa fa-info-circle'></i> About</div>
                        </div>
                    </div>
                </a>
            
            <div class="navbar-burger">
                <div class="burger-btn"><span><i class="fa fa-navicon"></i></span></div>
            </div>
            
            
            <div class="search-in"><span><i class="fa fa-search"></i></span></div>
            
                <div class="mode">
                    <span class="sun"><i class="fa fa-sun-o"></i></span>
                    <span class="moon"><i class="fa fa-moon-o"></i></span>
                </div>
            
        </div>
    </nav>
    <div class="burger-items">
        
        <a href="/">
            <div class="burger-item">
                <i class='fa fa-home'></i> Home
            </div>
        </a>
        
        <a href="/posts">
            <div class="burger-item">
                <i class='fa fa-book'></i> Posts
            </div>
        </a>
        
        <a href="/categories">
            <div class="burger-item">
                <i class='fa fa-folder-open'></i> Categories
            </div>
        </a>
        
        <a href="/series">
            <div class="burger-item">
                <i class='fa fa-gears'></i> Series
            </div>
        </a>
        
        <a href="/tags">
            <div class="burger-item">
                <i class='fa fa-tags'></i> Tags
            </div>
        </a>
        
        <a href="/about">
            <div class="burger-item">
                <i class='fa fa-info-circle'></i> About
            </div>
        </a>
        
    </div>
    <div class="header-rest"></div>
</header>


        <div id="content">








    <div class="hero">
        
            <div class="hero-img">
                <img class="lazyload" src="/images/thumbnail.gif" data-src="" alt="">
            </div>
        
        <div class="hero-content">
            <div class="hero-title">MFA與OTP</div>
            <div class="hero-subtitle"></div>
            <div class="hero-date">
                    <span class="no-wrap"><i class="fa fa-calendar"></i> postedOn: 2023-5-31 &nbsp;</span>
                    <span class="no-wrap"><i class="fa fa-calendar-check-o"></i> updatedOn: 2023-5-31 &nbsp;</span>
                    <span class="no-wrap"><i class="fa fa-folder"></i>
                        includedIn:
                        
                            <a href='
                                /categories/%E7%A8%8B%E5%BC%8F
                            '>
                                程式
                            </a>
                    </span>    
            </div>
            <div class="timelong">
                <span class="no-wrap"><i class="fa fa-pencil"></i> wordsCount: 758 &nbsp;</span>
                <span class="no-wrap"><i class="fa fa-clock-o"></i> readingTime: 2 mins &nbsp;</span>
                
            </div>
        </div>
    </div>




<div class="zhuti-0">
    <div class="container">
        <div class="zhuti">
            <div class="zhuti-l">
                




    


<div class="content-root">
    <div class="long">
        <button class="tosides-1 text-wbd">
            <i class="fa fa-arrow-right"></i>
        </button>
        <button class="tosides-2 text-wbd">
            <i class="fa fa-arrow-left"></i>
        </button>
        <button class="toup text-wbd">
            <i class="fa fa-arrow-up"></i>
        </button>
    </div>
    
        <div class="content">
            <div class="content-self">
                <h1 id="源起">源起</h1>
<p>最近自己在很多地方的登入都需要2FA驗證，先用手機裝驗證軟體掃ＱRCode，之後的每次登入都要輸入6位數字，
一直沒搞懂原理，但又覺得很酷，剛好最近要做一個python私人用的密碼管理程式，就在想能不能結合這個東西來驗證，
以下就是自己理解後名詞的介紹</p>
<h4 id="實作的github">實作的Github</h4>
<p><a href="https://github.com/hanksky12/Personal-Password-Manager">https://github.com/hanksky12/Personal-Password-Manager</a></p>
<hr>
<h1 id="mfamulti-factor-authentication">MFA(Multi-Factor Authentication)</h1>
<p>除了密碼之外，在登入時有其他驗證須通過就可以稱為多重驗證(多因子驗證)</p>
<p>例子：輸入手機收到的簡訊數字、線上銀行ATM提款卡、手機TOTP的六位數字</p>
<h2 id="2fa">2FA</h2>
<p>MFA的特例，兩種驗證就是2FA，以此類推</p>
<hr>
<h1 id="otpone-time-password">OTP(One Time Password)</h1>
<p>一次性驗證碼，用完就丟，只能用一次，其中有名的演算法是HOTP和TOTP</p>
<h2 id="hotphmac-based">HOTP(HMAC-based)</h2>
<p>HMAC雜湊訊息驗證碼
<a href="https://datatracker.ietf.org/doc/html/rfc4226#page-5">RFC4226</a></p>
<pre tabindex="0"><code>HOTP(K,C) = Truncate(HMAC-SHA-1(K,C))

   C       8-byte counter value, the moving factor.  This counter
           MUST be synchronized between the HOTP generator (client)
           and the HOTP validator (server).

   K       shared secret between client and server; each HOTP
           generator has a different and unique secret K.
</code></pre><h3 id="白話文">白話文：</h3>
<p>用一串key string 加上 counter計數器，做Hash之後，取特定位數做比對</p>
<h3 id="實作">實作：</h3>
<p>產出器將key傳到比對器之後，兩邊各自跑counter計數器，看最後出來的值是否一致</p>
<ol>
<li>兩邊各自跑counter，所以可能有前後落差要處理</li>
<li>最後只取特定位數 ，所以要限制比對次數，避免被大量嘗試攻擊</li>
<li>重點在key必須隱蔽的傳到對方的比對器，不能外流</li>
</ol>
<h2 id="totptime-based">TOTP(Time-based)</h2>
<p>HOTP的特化版，counter計數器使用timestamp</p>
<h3 id="why-30秒">why 30秒?</h3>
<p>必然server跟手機不可能時間永遠同步， 在兩邊跑出來的結果可能有落差，通常使用30秒才換一次，
來容納兩邊的時間不同步，否則驗證失敗可能性太高，server壓力太大，</p>
<h3 id="why-6位數">why 6位數?</h3>
<p>6位數，是一百萬組可能性，需在30秒內嘗試完成，每秒要驗證3.3萬次，server後台可以藉此鎖定黑名單</p>
<h3 id="qrcode">QRCode</h3>
<p>用來傳遞key string，所以要確保隱蔽，通常網站讓你掃完就會消失，無法存檔，確保只有你的手機有這個key</p>
<h3 id="python實作套件">python實作套件</h3>
<pre tabindex="0"><code>import pyotp  
#限制base32的key才能使用
_otp = pyotp.TOTP(base32_key)
</code></pre><hr>
<h1 id="參考資料">參考資料</h1>
<p><a href="https://en.wikipedia.org/wiki/Time-based_one-time_password">https://en.wikipedia.org/wiki/Time-based_one-time_password</a></p>
<p><a href="https://fullstackladder.dev/blog/2017/09/07/one-time-pass-introduce-with-hotp-totp-google-authenticator/">https://fullstackladder.dev/blog/2017/09/07/one-time-pass-introduce-with-hotp-totp-google-authenticator/</a></p>
<p><a href="https://medium.com/starbugs/totp-2fa-algorithm-in-10-mins-25acc3c35df9">https://medium.com/starbugs/totp-2fa-algorithm-in-10-mins-25acc3c35df9</a></p>

            </div>
            
                <div class="tags">
                    
                    <span class="down-type-item">
                        <div class="type-text">
                            <a href='
                                        /tags/%E7%9F%A5%E8%AD%98
                                    '>
                                <i class="fa fa-tag"></i> 知識
                            </a>
                        </div>
                    </span>
                    
                    <span class="down-type-item">
                        <div class="type-text">
                            <a href='
                                        /tags/%E9%A9%97%E8%AD%89
                                    '>
                                <i class="fa fa-tag"></i> 驗證
                            </a>
                        </div>
                    </span>
                    
                </div>
            
        </div>
        
            
                <div class="pre-next">
                    
    
        
        <a href="https://hanksky12.github.io/posts/2023-05-18_hello_world/" class="pre pre-last" style="text-align: center;">
            <span class="pre-icon"><i class="fa fa-hand-o-left"></i></span>
            <div class="pre-title-root">
                <span>Hello World</span>
            </div>
        </a>
        
    
    

                </div>
            
        
    
</div>

    
        <div class="content-last">
            
                <button class="aixin content-last-item efct-button">
                    <i class="fa fa-heart"></i>
                </button>
            
            
        </div>
    


            </div>
            <div class="zhuti-r">
                
<div class="zhuti-r-0">
    <div class="zhuti-r-1">
        
        <div id="r1">
            

<div class="about-zuozhe">
    <div class="zuozhe">
        
            <div class="datou">
                <img class="lazyload" src="/images/thumbnail.gif" data-src="/images/author.ico" alt="">
            </div>
        
        <div class="name-jianjie">
            <div class="name">HankSky</div>
            <div class="jianjie">
                Hello This World!
            </div>
        </div>
    </div>

    <div class="type">
        <a href='
                    /posts/
                '>
            <p>posts</p>
            <p>2</p>
        </a>
        <a href='
                    /categories/
                '>
            <p>categories</p>
            <p>2</p>
        </a>
        <a href='
                    /tags/
                '>
            <p>tags</p>
            <p>3</p>
        </a>
    </div>

    <a href="https://github.com/hanksky12?tab=repositories">
        <div class="follow">Follow Me</div>
    </a>
    <div class="link">
        
        <a href="https://github.com/hanksky12" class="link-item is-hidden-desktop" title="GitHub">
            <span class="icon"><i class='fa fa-github'></i></span>
        </a>
        
        <a href="https://www.instagram.com/orz.iloveyou/" class="link-item is-hidden-desktop" title="IG">
            <span class="icon"><i class='fa fa-instagram'></i></span>
        </a>
        
    </div>
</div>
            <div class="mulu">
    <div class="dong"></div>
    <div class="zhi">
        <div class="wenzi">
            <div class="zhi-mulu text-wbd">Table of Contents</div>
            <div class="mulu-items">
            </div>
        </div>
    </div>
</div>
            



    
    


<div class="other">
    <div class="other-up">
        <div class="other-qita text-wbd">Related Posts</div>
        <div class="xian"></div>
    </div>
    <div class="list">
        
            <a href="https://hanksky12.github.io/posts/2023-05-18_hello_world/">
                
<a href="https://hanksky12.github.io/posts/2023-05-18_hello_world/">
    <div class="list-item">
        <div class="icon-other-root">
            
                <div class="icon-other" style="background-image: url(  );"></div>
            
        </div>
        <div class="list-right">
            <div class="other-title">
                Hello World
            </div>
            <div class="other-summary">Hello World! 就像每次學習新的語言， Hello world都是第一個印在console的字眼， 記得 第一次學習 &gt;程式</div>
            <div class="other-date">2023-5-18</div>
        </div>
    </div>
</a>
            </a>
        
    </div>
</div>
        </div>
        <div id="r2">
            
        </div> 
    </div>
</div>

            </div>
        </div>
    </div>
</div>

    

<div class="sponsor">
    <div class="sponsor-self">
        <div class="sponsor-title">Sponsor</div>
        <div class="sponsor-btn">
            
                
                    
                        <div class="sponsor-btn-1 border-r">Wechat</div>
                    
                
                
            
                
                    
                        <div class="sponsor-btn-2 border-l">Alipay</div>
                    
                
                
            
        </div>
        
        <div class="sponsor-img">
            
                
                    <img class="sponsor-img-1" src="/images/sponsor/wechat.jpeg" alt="">
                
                
            
                
                    <img class="sponsor-img-2" src="/images/sponsor/alipay.jpeg" alt="" style="display: none;">
                
                
            
        </div>
        <div class="cancel efct-button">cancel</div>
    </div>
</div>


        </div>

        <footer class="footer">
    
        <div class="container">
            <div class="footer-items">
                
                
                    <div class="footer-item">
                        © 2023-2023 <a href="https://github.com/hanksky12?tab=repositories">HankSky</a>
                    </div>
                
                
            </div>
        </div>
    

    
        
    <div>
        <meting-js
            server = "netease"
            type = "playlist"
            id = "752439587"
            fixed = "true"
            autoplay = "false"
            loop = "all"
            order = "random"
            preload = "auto"
            list-folded = ""
            list-max-height = "500px"
            lrc-type = "1">
        </meting-js>
    </div>

    
</footer>


        
        <div class="search-root">
    <div class="search-zz"></div>
    <div class="search">
        <div class="sheader anniu">
            <div class="sh-l">
                <input type="text" placeholder='Enter a KeyWord' id="search-key">
                <span class="sclear"><i class="fa fa-close"></i></span>
            </div>
            <div class="sh-r">
                <button>search</button>
            </div>
        </div>
        <div class="sbody">
            <div class="sbody-1">
                <div class="stip"></div>
            </div>
        </div>
    </div>
</div>
        









    
    

    
    


<script type="text/javascript">
    var mode_custom = "auto";
    var postsCount =  2 ;
    var arrPosts = [{"link":"https://hanksky12.github.io/posts/2023-05-31_otp/","plain":"源起 最近自己在很多地方的登入都需要2FA驗證，先用手機裝驗證軟體掃ＱRCode，之後的每次登入都要輸入6位數字， 一直沒搞懂原理，但又覺得很酷，剛好最近要做一個python私人用的密碼管理程式，就在想能不能結合這個東西來驗證， 以下就是自己理解後名詞的介紹\n實作的Github https://github.com/hanksky12/Personal-Password-Manager\nMFA(Multi-Factor Authentication) 除了密碼之外，在登入時有其他驗證須通過就可以稱為多重驗證(多因子驗證)\n例子：輸入手機收到的簡訊數字、線上銀行ATM提款卡、手機TOTP的六位數字\n2FA MFA的特例，兩種驗證就是2FA，以此類推\nOTP(One Time Password) 一次性驗證碼，用完就丟，只能用一次，其中有名的演算法是HOTP和TOTP\nHOTP(HMAC-based) HMAC雜湊訊息驗證碼 RFC4226\nHOTP(K,C) = Truncate(HMAC-SHA-1(K,C)) C 8-byte counter value, the moving factor. This counter MUST be synchronized between the HOTP generator (client) and the HOTP validator (server). K shared secret between client and server; each HOTP generator has a different and unique secret K. 白話文： 用一串key string 加上 counter計數器，做Hash之後，取特定位數做比對\n實作： 產出器將key傳到比對器之後，兩邊各自跑counter計數器，看最後出來的值是否一致\n兩邊各自跑counter，所以可能有前後落差要處理 最後只取特定位數 ，所以要限制比對次數，避免被大量嘗試攻擊 重點在key必須隱蔽的傳到對方的比對器，不能外流 TOTP(Time-based) HOTP的特化版，counter計數器使用timestamp\nwhy 30秒? 必然server跟手機不可能時間永遠同步， 在兩邊跑出來的結果可能有落差，通常使用30秒才換一次， 來容納兩邊的時間不同步，否則驗證失敗可能性太高，server壓力太大，\nwhy 6位數? 6位數，是一百萬組可能性，需在30秒內嘗試完成，每秒要驗證3.3萬次，server後台可以藉此鎖定黑名單\nQRCode 用來傳遞key string，所以要確保隱蔽，通常網站讓你掃完就會消失，無法存檔，確保只有你的手機有這個key\npython實作套件 import pyotp #限制base32的key才能使用 _otp = pyotp.TOTP(base32_key) 參考資料 https://en.wikipedia.org/wiki/Time-based_one-time_password\nhttps://fullstackladder.dev/blog/2017/09/07/one-time-pass-introduce-with-hotp-totp-google-authenticator/\nhttps://medium.com/starbugs/totp-2fa-algorithm-in-10-mins-25acc3c35df9\n","pubDate":"2023-05-31","title":"MFA與OTP"},{"link":"https://hanksky12.github.io/posts/2023-05-18_hello_world/","plain":"Hello World!\n就像每次學習新的語言， Hello world都是第一個印在console的字眼，\n記得\n第一次學習 \u0026gt;程式語言Python\n第一次學習\u0026gt;處理資料用的語言R\n第一次學習\u0026gt;靜態語言C#\n第一次學習\u0026gt;前端語言Js\n第一次學習\u0026gt;網站語言Php\n待續\u0026hellip;\n","pubDate":"2023-05-18","title":"Hello World"}];
    var search_theEnd = "The End";
    var search_nothing = "Nothing was found";
    var search_found = "Found";
    var search_result = "result";
    var search_results = "results";
    var enable_mermaid =  null 
</script>





        
    </body>
</html>

